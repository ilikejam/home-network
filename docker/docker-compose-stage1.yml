version: '3'
  letsencrypt:
    build: ./letsencrypt
    image: letsencrypt
    container_name: letsencrypt
    restart: "no"
    volumes:
      - letsencrypt_etc:/etc/letsencrypt
    command: bash -c 'certbot certonly --standalone --preferred-challenges http-01 --http-01-port 8000 --agree-tos --non-interactive -m dave@davidstark.name -d "wiki.davidstark.name" -d "pi.davidstark.name"; cat /etc/letsencrypt/live/wiki.davidstark.name/fullchain.pem /etc/letsencrypt/live/wiki.davidstark.name/privkey.pem > /etc/letsencrypt/haproxy.pem'
    ports:
      - 80:8000
    
volumes:
  letsencrypt_etc:
